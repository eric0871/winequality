# Results

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
read the data
```{r}
library(tidyverse)
library(gridExtra)

df<- read.csv("resource/winequality-red.csv", sep = ';', head = T)
```

producing boxplots for each of the variables
```{r,warning=FALSE,message=FALSE}
draw_box <- function(df,variable)
{
  plot <- ggplot(data = df, aes(x = variable)) + 
           geom_boxplot() +
           xlab(substring(deparse(substitute(variable)),4))
            
  return(plot)
}

grid.arrange(draw_box(df, df$fixed.acidity),
             draw_box(df, df$volatile.acidity),
             draw_box(df, df$citric.acid),
             draw_box(df, df$residual.sugar),
             draw_box(df, df$chlorides),
             draw_box(df, df$free.sulfur.dioxide),
             draw_box(df, df$total.sulfur.dioxide),
             draw_box(df, df$density),
             draw_box(df, df$pH),
             draw_box(df, df$sulphates),
             draw_box(df, df$alcohol),
             draw_box(df, df$quality),
             ncol = 3)
```

find correlation for each pairs of variables.
```{r,warning=FALSE,message=FALSE}
library(GGally)
ggpairs(df, upper = list(continuous = wrap("cor", size = 2.5)), axisLabels="none", progress = FALSE)
```


Find correlation for each pairs of variables.
```{r,warning=FALSE,message=FALSE}
library(ggcorrplot)

cormap <- round(cor(df),1)

ggcorrplot(cormap, hc.order = TRUE, type = "lower", lab = TRUE)

```

When beginners first drink red wine, its much easier to taste the level of Sweetness and acidity of the red wine. We draw the scatterplot for residual sugar and volatile acidity with quality. We can see that only red wines with quality 4,5,6 have high and middle residual sugar and low and good quality red wines only have low residual sugar. So, if you feel the red wine is very sweet or even a little sweet, the quality red wine you drink is probably average.
We also can see that only red wine with quality 3,4,5 has high volatile acidity. So, if you feel the red wine is very sour, the quality red wine you drink is probably low or average.

```{r,warning=FALSE,message=FALSE}
grid.arrange(
  ggplot(data = df, aes(x = quality, y = residual.sugar)) +
  geom_jitter(aes(color = residual.sugar))+
scale_color_distiller(palette = "RdYlGn")+
    ggtitle('Residual sugar with quality')+
  theme(legend.position="bottom"),
ggplot(data = df, aes(x = quality, y = volatile.acidity)) +
  geom_jitter(aes(color = volatile.acidity))+
scale_color_distiller(palette = "RdYlGn")+
    ggtitle('Volatile acidity with quality')+
  theme(legend.position="bottom"),
ncol=2
)
```





```{r,warning=FALSE,message=FALSE}
library(tidyr)
library(ggplot2)
library(ggpubr)
library(dplyr)
library(reshape2)
library(GGally)
library(viridis)

red_df <- read.csv("resource/winequality-red.csv", sep = ';', head = T)
```

Lets create a new column quality_category to indicate whether a wine is good (quality > 6), or average (quality = 5 or 6), or poor (quality < 5)

```{r,warning=FALSE,message=FALSE}
red_df$quality_category <- cut(red_df$quality,breaks=c(2,4,6,9),labels = c('poor','average','good'))
```


Let's first plot the histogram of every variable.

```{r,warning=FALSE,message=FALSE}
ggplot(gather(red_df[1:12]), aes(value)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~key, scales = 'free_x')
```

From the histogram, there are several things we observed:
1. Density, pH, volatile acidity are normally distributed.
2. Chlorides and residual sugar have low variance.
3. Alcohol level, fixed acidity, free sulfur dioxide, sulphates, and total sulfur dioxide are right skewed.
4. Citric acid has a plateau distribution.
5. Most wine has quality of 5 and 6.

```{r,warning=FALSE,message=FALSE}
oldpar = par(mfrow = c(2,6))
for ( i in 1:12 ) {
  boxplot(red_df[[i]])
  mtext(names(red_df)[i], cex = 0.8, side = 1, line = 2)
}
par(oldpar)
```

From the boxplots, we have the following observations:
1. Every variable has outliers.
2. The median of our dependent variable - quality is 6.


In order to discover the relationships between each variable, let's show the heatmap of correlation matrices.

```{r,warning=FALSE,message=FALSE}
cm <- round(cor(red_df[1:12]),2)
melt_cm = melt(cm)

ggplot(data = melt_cm,aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab") +
  geom_text(aes(Var2, Var1, label = value), color = "black", size = 4)
```


```{r,warning=FALSE,message=FALSE}
pairs(red_df[1:12], col = red_df$quality, lower_panel = NULL)
```

From the heatmap, the variables that have high correlation with quality are alcohol, volatile acidity, sulphates,  citric acid, and 
Next, let's take a look at some bavariate graphs of these variables.



```{r,warning=FALSE,message=FALSE}
red_df$quality <- as.factor(red_df$quality)

a <- ggplot(red_df, aes(x=quality, y=alcohol, fill=quality_category)) + 
  geom_boxplot() + theme(legend.position = "none")

b <- ggplot(red_df, aes(x=quality, y=volatile.acidity, fill=quality_category)) + 
  geom_boxplot() 

c <- ggplot(red_df, aes(x=quality, y=sulphates, fill=quality_category)) + 
  geom_boxplot() + theme(legend.position = "none")

d <- ggplot(red_df, aes(x=quality, y=citric.acid, fill=quality_category)) + 
  geom_boxplot() + theme(legend.position = "none")

ggarrange(a, b, c, d, ncol = 2, nrow = 2,
                    common.legend = TRUE, legend = "right")
```


Alcohol has the strongest correlation with quality in our dataset. And from this graph, we can clearly see this relationship. Better wines have a high alcohol percentage. It is either because strong wines are more tasty or people who rates wines are wine lovers and they favor strong wines.




From the graph above, we can tell that volatile acidity has a negative relationship with quality. Better wines tend to have lower median of volatile acidity.

Sulphates seems to have positive relationship with quality. Better wines have higher median of sulphates level.

Citric acid seems to have positive relationship with quality. Better wines have higher median of citric acid level.

The following graph could further justify the above mentioned relationship between wine quality and alcohol density. 
```{r,warning=FALSE,message=FALSE}
f1 = ggplot(red_df, aes(alcohol, quality, color = quality_category)) + 
  geom_point() + 
  facet_grid(cols = vars(quality_category)) +
  scale_fill_manual(labels=letters[1:3], values=c("red","blue","green"))

f2 = ggplot(red_df, aes(volatile.acidity, quality, color = quality_category)) + 
  geom_point() + 
  facet_grid(cols = vars(quality_category)) +
  scale_fill_manual(labels=letters[1:3], values=c("red","blue","green"))


f3 = ggplot(red_df, aes(sulphates, quality, color = quality_category)) + 
  geom_point() + 
  facet_grid(cols = vars(quality_category)) +
  scale_fill_manual(labels=letters[1:3], values=c("red","blue","green"))

f4 = ggplot(red_df, aes(citric.acid, quality, color = quality_category)) + 
  geom_point() + 
  facet_grid(cols = vars(quality_category)) +
  scale_fill_manual(labels=letters[1:3], values=c("red","blue","green"))

ggarrange(f1,f2,f3,f4, ncol = 2, nrow = 2,
                    common.legend = TRUE)

```


Then, let's study how the combination of two variables affect quality by looking at some multivariate graphs.

```{r,warning=FALSE,message=FALSE}
red_df$quality <- as.numeric(red_df$quality)
ggplot(data = red_df, aes(x=alcohol,y=volatile.acidity,color = quality))+
  geom_point()+
  facet_wrap(red_df$quality_category)+
  scale_colour_gradient(low = "Blue",
                        high = "Orange", na.value = "black")

```

From the graph above, wee can see that good wines have higher alcohol and low volatile acidity levels than the other two groups with some outliers. The wine with the highest alcohol level scored only a 5 in quality.
Also, the poor wines seem to have a dispersed distribution suggesting that people are consistent in the standards of good wines but inconsistent in the standards of poor wines.

```{r,warning=FALSE,message=FALSE}
ggplot(data = red_df, aes(x=alcohol,y=chlorides,color = quality))+
  geom_point()+
  facet_wrap(red_df$quality_category)+
  scale_colour_gradient(low = "Blue",
                        high = "Orange", na.value = "black")
```

This graph is interesting because it shows that most wines that have high chlorides level are categorized as average wines. This pattern suggests that chlorides may have a non-linear relationship with quality.

```{r,warning=FALSE,message=FALSE}
ggplot(data = red_df, aes(x=volatile.acidity,y=chlorides,color = quality))+
  geom_point()+
  facet_wrap(red_df$quality_category)+
  scale_colour_gradient(low = "Blue",
                        high = "Orange", na.value = "black")
```

This graph supports our theory before that people have consistent standards of good wine and inconsistent standards of poor wines. Because all good wines are clustered in the lower left corner of the graph and poor wines have dispersed distribution.




```{r,warning=FALSE,message=FALSE}
q <- cut(red_df$residual.sugar,breaks=4,labels = c("0-25","25-50","50-75","75-100"))
ggplot(red_df, aes(fixed.acidity,alcohol,color = alcohol))+
  geom_point()+
  facet_wrap(q)+
  scale_colour_gradient(low = "Blue",
                        high = "Orange", na.value = "black")
```
This graph shows that for low fixed.acidity and high alcohol, the wine's residual.sugar values usually remain at very low level. 



```{r,warning=FALSE,message=FALSE}
red_df$taste <- cut(red_df$quality,breaks=2,labels = c('poor','good'))
ggparcoord(red_df, columns = c(1,2,3,4,10,11), alphaLines = .1
           , scale = "globalminmax", splineFactor = 1, groupColumn = 14)
```
From the above parallel coordinate plot, it can further validate our correlation relationships between different variables. It can also indicates which factor leads to good taste for the red wine. 








